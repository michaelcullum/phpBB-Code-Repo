<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.2.xsd">
	<header>
		<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
		
		<title lang="en">phpBB Code Repository</title>
		
		<description lang="en">A Code Repository MOD, it allows the viewing of source code/images in the ACP-specified source directory, and also offers syntax highlighting of the source VIA GeSHi.</description>
		
		<author-notes lang="en">Be sure to allow read access to the source/ folder, along with keeping a file in the folder at all times for the server's sake.</author-notes>
		
		<author-group>
			<author>
				<realname>Obsidian</realname>
				<username>Desdenova</username>
				<homepage>http://www.infinityhouse.org/</homepage>
			</author>
		</author-group>
		
		<mod-version>1.0.6</mod-version>
		
		<installation>
			<level>easy</level>
			<time>300</time>
			<target-version>3.0.4</target-version>
		</installation>

		<history>
			<entry>
				<date>2008-07-01</date>
				<rev-version>0.5.0</rev-version>
				<changelog lang="en">
					<change>Rewrote the entire thing to use crawldir(), etc. etc. and not cheating by piggy-backing off of viewtopic.</change>
					<change>First public release, all files held in own CRS.</change>
				</changelog>
			</entry>
			<entry>
				<date>2008-12-23</date>
				<rev-version>1.0.0 RC 1</rev-version>
				<changelog lang="en">
					<change>Updated files and merged viewcode.php, downcode.php, and code.php together.  Only released RC1 on www.infinityhouse.org</change>
					<change>Added cache system integration to reduce server strain and improve speed.</change>
					<change>Heavily nubbed the code, LOTS of parse errors.</change>
				</changelog>
			</entry>
			<entry>
				<date>2008-12-27</date>
				<rev-version>1.0.0 RC 2</rev-version>
				<changelog lang="en">
				    <change>Updated code, tested, and debugged all parse errors.</change>
				    <change>Fixed this and that and wrote a /decent/ cache rebuild mode this time.</change>
				    <change>Added GeSHi integration, a lot of code ripped off of eviL&lt;3's Pastebin MOD for that.  Wonderful MOD, by the way, Igor!</change>
				    <change>Rewrote functions into a class, and made many things automatic VIA the constructor method.</change>
				    <change>Idiot-proofed a few more things and made interface a /little/ more user friendly.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-03-02</date>
				<rev-version>1.0.0 RC 3</rev-version>
				<changelog lang="en">
					<change>[Fix] Caching now works properly.</change>
					<change>[Fix] Downloading files works correctly now.</change>
					<change>[Fix] Show the friendly filetypes finally.</change>
					<change>[Security] Remove the root_path from the file's location</change>
					<change>[Security] Don't reference images directly from their location in the source/ dir, use image piping.</change>
					<change>[Update] GeSHi updated to 1.0.8.2.</change>
					<change>[Update] Crawldir and caching framework updated to version 1.2.0.</change>
					<change>[Change] Rewrote the constructor class for more logical layout.</change>
					<change>[Change] Separated the view-source and directory browser modes.</change>
					<change>[Change] Add quick download links.</change>
					<change>[Change] Show current location-path in the navbar area.</change>
					<change>[Change] Make highlighting its own mode.</change>
					<change>[Change] Organize out the functions!  Separated file functions into their own class, along with misc functions.</change>
					<change>[Change] Using a Bootstrap system for smarter layout of code.</change>
					<change>[Feature] Asyncronous installations possible with a few file edits and some file copying.</change>
					<change>[Feature] Add authorizations for phpBB-CRS.</change>
					<change>[Feature] Allow source file directory to be changed in an ACP module.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-03-09</date>
				<rev-version>1.0.0</rev-version>
				<changelog lang="en">
					<change>[Update] Crawldir caching framework slightly updated.</change>
					<change>[Change] Move recaching of Code Repository filelist to ACP module.</change>
					<change>[Change] Altered template file a bit, merged the filelist and directory list into one giant glob.</change>
					<change>[Change] Add quick highlight links if permitted to use highlighting.</change>
					<change>[Change] Asyncronous installation removed.</change>
					<change>[Change] XHTML Source built for code highlighting now XHTML 1.0 Strict valid.</change>
					<change>[Feature] Dynamic updir!</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-03-10</date>
				<rev-version>1.0.1</rev-version>
				<changelog lang="en">
					<change>[Security] IN_PHPBB checks stuffed into GeSHi language files and GeSHi itself.</change>
					<change>[Change] Fix the MODx file for proper date format.</change>
					<change>[Change] Hide the download information in the template file if the user cannot download.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-04-03</date>
				<rev-version>1.0.2</rev-version>
				<changelog lang="en">
					<change>[Feature] $id$ replacement (like SVN).</change>
					<change>[Feature] Show file type that's detected in the browse mode in the view mode.</change>
					<change>[Feature] Added a version check.</change>
					<change>[Change] Use static class for crs_file_fns references.</change>
					<change>[Change] Rename crs_file_fns class to file_fns.</change>
					<change>[Change] Added image filetypes to the guess_lang function.  Will now know PNG, JPG, and GIF files.</change>
					<change>[Change] Slightly better error handling.  Will now check to see if the GeSHi is loaded before attempting to initiate it.</change>
					<change>[Change] Now using a constant CRS_VERSION for storing file-based version number.</change>
					<change>[Change] Have a proper blank mode instead of hardcoding it to browse.</change>
					<change>[Change] Using static call to crs_core in file_fns::identify_ext. No longer dependent on $crs being initiated.</change>
					<change>[Change] Added mimetype-guessing function guess_mimetype to includes/crs/crs_download.php to guess mimetype VIA file's extension.</change>
					<change>[Change] Make Windows XP display the code in a readable size, already.  Using a useragent check for this.</change>
					<change>[Change] Cleaned up code in code.php, includes/crs/crs_core.php, includes/crs/bootstrap.php, and elsewhere.</change>
					<change>[Fix] Fixed extension handling.  It's now safe to use non-lowercase extensions.</change>
					<change>[Fix] If viewing an image, get a "Viewing Image" title and not a "Viewing Source Code" title.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-04-14</date>
				<rev-version>1.0.3</rev-version>
				<changelog lang="en">
					<change>[Feature] EAMI integration in installer, automatically add ACP module.</change>
					<change>[Change] Move guess_mimetype() and get_mimetype() functions from includes/crs/crs_download.php to includes/crs/crs_misc_functions.php</change>
					<change>[Change] Have file_fns::check_image() use get_mimetype() and a strpos check instead of what it currently is.</change>
					<change>[Change] Fix commenting style in the language file. Sheesh, you validators are picky. :P</change>
					<change>[Fix] Fix indentation in code.php.</change>
					<change>[Fix] Fix HTML use in code.php</change>
					<change>[Fix] Cleaned up ACP module</change>
					<change>[Fix] Get the font-size make-bigger-thinger to work for Windows users, finally.  -.-;</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-04-24</date>
				<rev-version>1.0.4</rev-version>
				<changelog lang="en">
					<change>[Update] Crawldir and caching framework updated to version 1.4.1.</change>
					<change>[Fix] Fix relative path issue.</change>
					<change>[Fix] Version checking in ACP no longer causes the recache button to disappear.</change>
					<change>[Fix] Undefined function file_gc() that was forgotten was added to includes/crs/crs_download.php.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-05-09</date>
				<rev-version>1.0.5</rev-version>
				<changelog lang="en">
					<change>[Fix] Fix downloading issue.</change>
					<change>[Change] Remove $Id$ replacement feature.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-06-08</date>
				<rev-version>1.0.6</rev-version>
				<changelog lang="en">
					<change>[Fix] Fix installer issue.</change>
					<change>[Fix] MODX mistakes for EAMI.</change>
					<change>[Sec] Fix a mistake in the ACP module for setting source dir.</change>
				</changelog>
			</entry>
		</history>

		<link-group>
			<link type="contrib" href="contrib/upgrade_1-0-RC2_to_1-0-RC3.xml" lang="en">Upgrade from phpBB-CRS 1.0 Release Candidate 2</link>
			<link type="contrib" href="contrib/upgrade_1-0-RC3_to_1-0-0.xml" lang="en">Upgrade from phpBB-CRS 1.0 Release Candidate 3</link>
			<link type="contrib" href="contrib/upgrade_1-0-0_to_1-0-1.xml" lang="en">Upgrade from phpBB Code Repository 1.0.0</link>
			<link type="contrib" href="contrib/upgrade_1-0-1_to_1-0-2.xml" lang="en">Upgrade from phpBB Code Repository 1.0.1</link>
			<link type="contrib" href="contrib/upgrade_1-0-2_to_1-0-3.xml" lang="en">Upgrade from phpBB Code Repository 1.0.2</link>
			<link type="contrib" href="contrib/upgrade_1-0-3_to_1-0-4.xml" lang="en">Upgrade from phpBB Code Repository 1.0.3</link>
		</link-group>

	</header>
	
	<action-group>
		<copy>
			<file from="root/code.php" to="code.php" />
			<file from="root/adm/style/acp_crs_main.html" to="adm/style/acp_crs_main.html" />
			<file from="root/includes/geshi.php" to="includes/geshi.php" />
			<file from="root/includes/acp/acp_crs_main.php" to="includes/acp/acp_crs_main.php" />
			<file from="root/includes/acp/info/acp_crs_main.php" to="includes/acp/info/acp_crs_main.php" />
			<file from="root/includes/crs/bootstrap.php" to="includes/crs/bootstrap.php" />
			<file from="root/includes/crs/crs_constants.php" to="includes/crs/crs_constants.php" />
			<file from="root/includes/crs/crs_core.php" to="includes/crs/crs_core.php" />
			<file from="root/includes/crs/crs_download.php" to="includes/crs/crs_download.php" />
			<file from="root/includes/crs/crs_file_functions.php" to="includes/crs/crs_file_functions.php" />
			<file from="root/includes/crs/crs_misc_functions.php" to="includes/crs/crs_misc_functions.php" />
			<file from="root/includes/geshi/*.*" to="includes/geshi/*.*" />
			<file from="root/install_crs/eami.php" to="install_crs/eami.php" />
			<file from="root/install_crs/index.php" to="install_crs/index.php" />
			<file from="root/language/en/mods/info_acp_crs_main.php" to="language/en/mods/info_acp_crs_main.php" />
			<file from="root/language/en/mods/lang_crs.php" to="language/en/mods/lang_crs.php" />
			<file from="root/language/en/mods/lang_crs_acp.php" to="language/en/mods/lang_crs_acp.php" />
			<file from="root/language/en/mods/lang_crs_install.php" to="language/en/mods/lang_crs_install.php" />
			<file from="root/language/en/mods/permissions_crs.php" to="language/en/mods/permissions_crs.php" />
			<file from="root/source/test.php" to="source/test.php" />
			<file from="root/source/.htaccess" to="source/.htaccess" />
			<file from="root/styles/prosilver/template/crs_body.html" to="styles/prosilver/template/crs_body.html" />
			<file from="root/styles/prosilver/theme/crs_style.css" to="styles/prosilver/theme/crs_style.css" />
		</copy>
		
		<open src="viewonline.php">
			<edit>
				<find>		case 'index':
			$location = $user->lang['INDEX'];
			$location_url = append_sid("{$phpbb_root_path}index.$phpEx");
		break;</find>
				<action type="after-add">//-- begin mod: phpBB Code Repository --
		case 'code':
			$location = $user->lang['VIEWING_CODE_REPO'];
			$location_url = append_sid("{$phpbb_root_path}code.$phpEx");
		break;
//-- end mod: phpBB Code Repository --</action>
			</edit>
		</open>
		<open src="includes/functions.php">
			<edit>
				<find>		'U_INDEX'				=> append_sid("{$phpbb_root_path}index.$phpEx"),</find>
				<action type="after-add">//-- begin mod: phpBB Code Repository --
		'U_CODE_REPO'				=> ($auth->acl_get('u_crs_view')) ? append_sid("{$phpbb_root_path}code.$phpEx") : '',
//-- end mod: phpBB Code Repository --</action>
			</edit>
		</open>
		<open src="language/en/common.php">
			<edit>
				<find>	'CLOSE_WINDOW'			=> 'Close window',</find>
				<action type="after-add">//-- begin mod: phpBB Code Repository --
	'VIEW_CODE_REPO'			=> 'Code Repository',
	'VIEW_CODE_REPO_MORE'			=> 'View Code Repository',
	'VIEWING_CODE_REPO'			=> 'Viewing Code Repository',
//-- end mod: phpBB Code Repository --</action>
			</edit>
		</open>
		<open src="styles/prosilver/template/overall_header.html">
			<edit>
				<find><![CDATA[<link href="{T_STYLESHEET_LINK}" rel="stylesheet" type="text/css" media="screen, projection" />]]></find>
				<action type="after-add"><![CDATA[<!-- ## begin mod: phpBB Code Repository ## -->
		<!-- IF GESHI_STYLE -->
			<style type="text/css">
			<!--
				{GESHI_STYLE}
			-->
			</style>
		<!-- ENDIF -->
<!-- ## end mod: phpBB Code Repository ## -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[<!-- IF S_DISPLAY_MEMBERLIST --><li class="icon-members"><a href="{U_MEMBERLIST}" title="{L_MEMBERLIST_EXPLAIN}">{L_MEMBERLIST}</a></li><!-- ENDIF -->]]></find>
				<action type="before-add"><![CDATA[<!-- ## begin mod: phpBB Code Repository ## -->
					<!-- IF U_CODE_REPO --><li class="icon-pages"><a href="{U_CODE_REPO}" title="{L_VIEW_CODE_REPO_MORE}">{L_VIEW_CODE_REPO}</a></li><!-- ENDIF -->
<!-- ## end mod: phpBB Code Repository ## -->]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/theme/stylesheet.css">
			<edit>
				<find>@import url("forms.css");</find>
				<action type="after-add">/** begin mod: phpBB Code Repository **/
@import url("crs_style.css");
/** end mod: phpBB Code Repository **/</action>
			</edit>
		</open>
		
		<diy-instructions lang="en">Be sure to refresh the template and themes cache!  
Then, run the DCI file at http://yoursite.com/path_to_forums/install_crs/index.php, and be sure to set permissions afterwards.</diy-instructions>
	</action-group>
</mod>
